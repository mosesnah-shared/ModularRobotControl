%% Cleaning up + Environment Setup
clear; close all; clc;

% Change the matlab to current directory
cd(fileparts(matlab.desktop.editor.getActiveFilename));

% Add Explicit-MATLAB for visualization
% Activate setup Explicit-MATLAB
addpath( 'Explicit-MATLAB' );    
run('Explicit-MATLAB/setup.m');  % Replace 'myscript.m' with your actual script name

addpath( 'utils' );    

% Configure default figure properties
fig_config( 'fontSize', 20, 'markerSize', 10 )

tau_max = [ 320, 320, 176, 176, 110, 40, 40 ]';

% Figure directory for saving:
fig_dir = '../images/iiwa14_singularity_doing_work/';

%% (1A) Read txt file

% Open file
fid = fopen('../data/KUKAresult/iiwa14_exploit_torque1.txt','r');
if fid == -1
    error('Cannot open file');
end

xlim1 = 19; xlim2 = 24;

% Read using textscan with proper format
data = textscan(fid, [' External Torque' repmat(' %f', 1, 7) ...
                      ' Time: %f Joint Angle' repmat(' %f', 1, 7)]);

% Close file
fclose(fid);

% Assign parsed data to named arrays
ext_torque = [data{1:7}];   % External Torque (Nx7)
t_arr      = data{8};       % Time (Nx1)
joint_arr  = [data{9:15}];  % Joint Angles (Nx7)

t_arr = t_arr - xlim1;

f = figure( ); a = axes( 'parent', f );
plot( a, t_arr, ext_torque )
legend( 'Joint 1, $\tau_1$', 'Joint 2, $\tau_2$', 'Joint 3, $\tau_3$', 'Joint 4, $\tau_4$',...
                             'Joint 5, $\tau_5$', 'Joint 6, $\tau_6$', 'Joint 7, $\tau_7$', 'fontsize', 30, 'Location', 'northeastoutside' )
set( a, 'xlim', [0, xlim2-xlim1], 'fontsize', 30 )
xlabel( 'Time (s)', 'fontsize', 40 ); ylabel( 'Torque (N$\cdot$s)', 'fontsize', 40 )

exportgraphics( f, [fig_dir, 'kin_exploit_joint_torque_doing_work.pdf']);
